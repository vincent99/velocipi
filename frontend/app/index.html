<html>
  <head>
    <meta charset="UTF-8" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      h1 {
        font-size: 16px;
      }
      body {
        -webkit-font-smoothing: none;
        background: #111;
        color: white;
        overflow: hidden;
        width: 100vw;
        height: 100vh;
        font-family: sans-serif;
      }
      #ball {
        position: absolute;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: radial-gradient(circle at 35% 35%, #ff6, #f40);
        box-shadow: 0 0 12px #f804;
      }
      #knobs {
        position: absolute;
        top: 18px;
        left: 0;
        right: 0;
        display: flex;
        justify-content: center;
        gap: 8px;
        font-size: 9px;
        color: #888;
      }
      #knobs span { font-variant-numeric: tabular-nums; }
      #knobs b { color: #ccc; }
      #keys {
        position: absolute;
        bottom: 2px;
        left: 0;
        right: 0;
        display: flex;
        justify-content: center;
        gap: 3px;
      }
      .key {
        font-size: 9px;
        width: 16px;
        height: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #444;
        border-radius: 3px;
        color: #666;
        background: #1a1a1a;
        transition: none;
      }
      .key.active {
        color: #fff;
        background: #333;
        border-color: #aaa;
      }
    </style>
  </head>
  <body>
    <h1>Velocipi</h1>
    <div id="ball"></div>
    <div id="knobs">
      <span>out:<b id="kc-outer">0</b></span>
      <span>in:<b id="kc-inner">0</b></span>
      <span>joy:<b id="kc-joy">0</b></span>
    </div>
    <div id="keys"></div>
    <script defer>
      // Key display
      const keysEl = document.getElementById("keys");
      const keyState = {};

      const KEY_LABELS = {
        ArrowLeft:  "◀",
        ArrowRight: "▶",
        ArrowUp:    "▲",
        ArrowDown:  "▼",
        Enter:      "●",
        "[":        "[",
        "]":        "]",
        ";":        ";",
        "'":        "'",
        ",":        ",",
        ".":        ".",
      };

      function renderKeys() {
        keysEl.innerHTML = Object.entries(KEY_LABELS)
          .map(([k, label]) =>
            `<span class="key${keyState[k] ? " active" : ""}">${label}</span>`
          )
          .join("");
      }

      // Momentary keys (knob spins) stay lit briefly so they're visible.
      const momentaryKeys = new Set(["[", "]", ";", "'", ",", "."]);
      const momentaryTimers = {};

      document.addEventListener("keydown", e => {
        if (!(e.key in KEY_LABELS)) return;
        keyState[e.key] = true;
        renderKeys();
        if (momentaryKeys.has(e.key)) {
          clearTimeout(momentaryTimers[e.key]);
          momentaryTimers[e.key] = setTimeout(() => {
            keyState[e.key] = false;
            renderKeys();
          }, 150);
        }
      });
      document.addEventListener("keyup", e => {
        if (e.key in KEY_LABELS && !momentaryKeys.has(e.key)) {
          keyState[e.key] = false;
          renderKeys();
        }
      });

      renderKeys();

      // Knob counters
      const knobVals = { "kc-outer": 0, "kc-inner": 0, "kc-joy": 0 };
      const knobCounters = {
        "[": { id: "kc-outer", dir: -1 },
        "]": { id: "kc-outer", dir: +1 },
        ";": { id: "kc-inner", dir: -1 },
        "'": { id: "kc-inner", dir: +1 },
        ",": { id: "kc-joy",   dir: -1 },
        ".": { id: "kc-joy",   dir: +1 },
      };
      document.addEventListener("keydown", e => {
        const k = knobCounters[e.key];
        if (!k) return;
        knobVals[k.id] += k.dir;
        document.getElementById(k.id).textContent = knobVals[k.id];
      });

      const ball = document.getElementById("ball");
      const r = 5; // radius

      let x = 160,
        y = 120;
      let vx = 3.7,
        vy = 2.3;

      function step() {
        const W = window.innerWidth;
        const H = window.innerHeight;

        x += vx;
        y += vy;

        if (x - r < 0) {
          x = r;
          vx = Math.abs(vx);
        }
        if (x + r > W) {
          x = W - r;
          vx = -Math.abs(vx);
        }
        if (y - r < 0) {
          y = r;
          vy = Math.abs(vy);
        }
        if (y + r > H) {
          y = H - r;
          vy = -Math.abs(vy);
        }

        ball.style.left = x - r + "px";
        ball.style.top = y - r + "px";

        requestAnimationFrame(step);
      }

      requestAnimationFrame(step);
    </script>
  </body>
</html>
